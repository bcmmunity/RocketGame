
@{
	ViewData["Title"] = "Игра";
}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

<div id="moves">
	<span class="btn" onclick="move = 'powerup'; makeMove()">Усилиться</span>
	</br>
	</br>
	<span class="btn" onclick="move = 'intellectup'; makeMove()">Усилить интеллект</span>
	</br>
	</br>
	<span class="btn" onclick="move = 'gather'; makeMove()">Добыть</span>
	</br>
	</br>
	<span class="btn" onclick="move = 'attackgroup'; selectTeam()">Атаковать</span>
	</br>
	</br>
	<span class="btn" onclick="move = 'attackrocket'; selectTeam()">Атаковать ракету</span>
	</br>
	</br>
	<span class="btn" onclick="move = 'gift'; selectTeam()">Дарить</span>
	</br>
	</br>
	<span id="getinrocket" class='btn' onclick="move = 'getinrocket'; makeMove()">Сесть в ракету</span>
	</br>
	</br>
</div>
<div id="teams">
</div>
<div id="res">
	<h1 id="msg">Ваш ход сделан</h1>
</div>

<script type="text/javascript">
	var move = "s";
	var opt = "";
	var team = "0";

	var proces = true;

	$("#moves").hide();
	$("#teams").hide();
	$("#msg").empty();
	$("#msg").append("Игра еще не началась");
	
	setInterval(check, 5000);

	function check()
	{
		
		$.ajax({
			type: "GET",
			url: "/Game/RocketCheck",
			data: { Key: localStorage["Key"] },
			
			success: function(result) {
				if (result)
				{
					$("#getinrocket").show();
				}
				else
				{
					$("#getinrocket").hide();
				}
			}
		});

		$.ajax({
			type: "GET",
			url: "/Game/MoveCheck",
			data: { Key: localStorage["Key"] },
			
			success: function(result) {
				if (result == "Ход не сделан")
				{
					$("#msg").hide();
					$("#teams").hide();
					$("#moves").show();
				}
				else
				{
					$("#msg").empty();
					$("#msg").append(result);
					$("#msg").show();
					$("#teams").hide();
					$("#moves").hide();
				}
			}
		});
	}	

	function selectTeam()
	{
		$.ajax({
			type: "GET",
			url: "/Game/GroupList",
			
			success: function(result) {
				$("#moves").hide();
				$("#msg").hide();
				
				$("#teams").empty();
				$("#teams").show();
				//$("#teams").append(result);

				for (var item in result) {
					$("#teams").append("<span class='btn' onclick='team = " + result[item].teamId + "; makeMove()" + result[item].name + "</span>");
				}
			}
		});
	}	

	function makeMove()
	{
		$.ajax({
			type: "GET",
			url: "/Game/Make",
			data: { Type: move, Key: localStorage["Key"], TeamId: team },
			
			success: function(result) {
				$("#moves").hide();
				$("#teams").hide();

				$("#msg").empty();
				$("#msg").show();
				$("#msg").append(result);
			}
		});
	}
</script>

<style type="text/css">
	.btn {
		width: 20%;
		min-height: 20px;
		background-color: gray;
		border-radius: 200px;
		padding: 5px;
		float: left;
		color: white;
	}
</style>